#!/bin/sh

if [ -f cld.pid ]
then
	echo "cld.pid file found.  daemon still running?"
	exit 1
fi
if [ -f chunkd.pid ]
then
	echo "chunkd.pid file found.  daemon still running?"
	exit 1
fi
if [ -f tabled.pid ]
then
	echo "tabled.pid file found.  daemon still running?"
	exit 1
fi

# May be different on Solaris... like /usr/libexec or such.
cld -d data/cld -P cld.pid -p auto --port-file=cld.port -E

# With great sadness we have to use a delay, or else "100 s" happens.
sleep 3

chunkd -C $top_srcdir/test/chunkd-test.conf -E
../server/tabled -C $top_srcdir/test/tabled-test.conf -E

# We have a special client that waits for tabled to come online, but before
# that we also have tests that verify that the daemons started and wrote
# their PID files. So, we need to give the above daemons a chance to progress
# at least that far.
sleep 3

exit 0
